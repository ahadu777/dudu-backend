# PRD-008 Acceptance Criteria Mapping
# DeepTravel Mini-Program Travel Booking Platform

prd_id: PRD-008
title: DeepTravel Mini-Program Travel Booking Platform
last_updated: 2025-12-25
coverage_principle: "Coverage % = (有测试的AC数 / 总AC数) × 100"
phase_coverage: "Phase 1: Package Booking (Done)"

# ===== ACCEPTANCE CRITERIA =====

acceptance_criteria:

  # === 0. WeChat Authentication ===
  wechat_auth:
    - ac_id: AC-WECHAT-1
      description: "微信登录获取 openid"
      prd_source: "Core Features > WeChat Authentication"
      test_id: "0.1"
      status: tested

    - ac_id: AC-WECHAT-2
      description: "登录返回 JWT Token"
      prd_source: "Core Features > WeChat Authentication"
      test_id: "0.2"
      status: tested

    - ac_id: AC-WECHAT-3
      description: "手机号绑定 (可选)"
      prd_source: "Core Features > WeChat Authentication"
      test_id: "0.3"
      status: tested

    - ac_id: AC-WECHAT-4
      description: "无效 code 返回错误"
      prd_source: "Error Handling"
      test_id: "0.4"
      status: tested

    - ac_id: AC-WECHAT-5
      description: "登录响应 <500ms"
      prd_source: "Success Metrics"
      test_id: "0.5"
      status: tested

  # === 1. Product Catalog ===
  product_catalog:
    - ac_id: AC-CATALOG-1
      description: "查询小程序渠道产品列表"
      prd_source: "Core Features > Package Product Booking"
      test_id: "1.1"
      status: tested

    - ac_id: AC-CATALOG-2
      description: "查询产品详情 (含价格和权益)"
      prd_source: "Core Features > Package Product Booking"
      test_id: "1.2"
      status: tested

    - ac_id: AC-CATALOG-3
      description: "库存可用性检查"
      prd_source: "Business Rules > Dual Inventory System"
      test_id: "1.3"
      status: tested

    - ac_id: AC-CATALOG-4
      description: "渠道过滤 (direct channel)"
      prd_source: "Business Rules > Channel Allocation"
      test_id: "1.4"
      status: tested

  # === 2. Order Management ===
  order_management:
    - ac_id: AC-ORDER-1
      description: "创建订单 (含客户信息)"
      prd_source: "Core Features > Package Product Booking"
      test_id: "2.1"
      status: tested

    - ac_id: AC-ORDER-2
      description: "订单价格计算正确"
      prd_source: "Business Rules > Pricing Strategy"
      test_id: "2.2"
      status: tested

    - ac_id: AC-ORDER-3
      description: "订单状态查询"
      prd_source: "Core Features > My Tickets & Order Management"
      test_id: "2.3"
      status: tested

    - ac_id: AC-ORDER-4
      description: "订单列表 (分页)"
      prd_source: "Core Features > My Tickets & Order Management"
      test_id: "2.4"
      status: tested

    - ac_id: AC-ORDER-5
      description: "未登录创建订单返回 401"
      prd_source: "Error Handling"
      test_id: "2.5"
      status: tested

  # === 3. Payment Integration ===
  payment:
    - ac_id: AC-PAY-1
      description: "发起支付请求"
      prd_source: "Implementation Cards > wallyt-payment"
      test_id: "3.1"
      status: tested

    - ac_id: AC-PAY-2
      description: "支付回调处理"
      prd_source: "Implementation Cards > wallyt-payment"
      test_id: "3.2"
      status: tested

    - ac_id: AC-PAY-3
      description: "支付成功后订单状态更新"
      prd_source: "Implementation Cards > wallyt-payment"
      test_id: "3.3"
      status: tested

    - ac_id: AC-PAY-4
      description: "支付成功率 >98%"
      prd_source: "Performance Metrics"
      test_id: "3.4"
      status: tested

  # === 4. QR Ticket Issuance ===
  ticket_issuance:
    - ac_id: AC-TICKET-1
      description: "支付成功后自动发券"
      prd_source: "Core Features > My Tickets & Order Management"
      test_id: "4.1"
      status: tested

    - ac_id: AC-TICKET-2
      description: "票券列表查询"
      prd_source: "Core Features > My Tickets & Order Management"
      test_id: "4.2"
      status: tested

    - ac_id: AC-TICKET-3
      description: "票券 QR 码生成"
      prd_source: "Core Features > My Tickets & Order Management"
      test_id: "4.3"
      status: tested

    - ac_id: AC-TICKET-4
      description: "票券包含权益列表"
      prd_source: "Core Features > My Tickets & Order Management"
      test_id: "4.4"
      status: tested

    - ac_id: AC-TICKET-5
      description: "票券发放 <3s"
      prd_source: "Performance Metrics"
      test_id: "4.5"
      status: tested

  # === 5. Cancellation & Refund ===
  cancellation:
    - ac_id: AC-CANCEL-1
      description: ">24小时前取消 100%退款"
      prd_source: "Business Rules > Cancellation Policy"
      test_id: "5.1"
      status: tested

    - ac_id: AC-CANCEL-2
      description: "12-24小时前取消 50%退款"
      prd_source: "Business Rules > Cancellation Policy"
      test_id: "5.2"
      status: tested

    - ac_id: AC-CANCEL-3
      description: "<12小时前取消 0%退款"
      prd_source: "Business Rules > Cancellation Policy"
      test_id: "5.3"
      status: tested

# ===== COVERAGE SUMMARY =====

coverage_summary:
  total_ac: 26
  tested: 26
  needs_fix: 0
  coverage_percentage: "100% (26/26)"
  phase_note: "Phase 1 (Package Booking) 完整覆盖"

# ===== TEST STRUCTURE =====

test_structure:
  - folder: "0. 微信认证"
    tests:
      - "0.1 微信登录"
      - "0.2 获取JWT Token"
      - "0.3 手机号绑定"
      - "0.4 无效code错误"
      - "0.5 登录响应时间"

  - folder: "1. 产品目录"
    tests:
      - "1.1 产品列表"
      - "1.2 产品详情"
      - "1.3 库存可用性"
      - "1.4 渠道过滤"

  - folder: "2. 订单管理"
    tests:
      - "2.1 创建订单"
      - "2.2 价格计算"
      - "2.3 订单状态"
      - "2.4 订单列表"
      - "2.5 未登录401"

  - folder: "3. 支付集成"
    tests:
      - "3.1 发起支付"
      - "3.2 支付回调"
      - "3.3 状态更新"
      - "3.4 成功率"

  - folder: "4. 票券发放"
    tests:
      - "4.1 自动发券"
      - "4.2 票券列表"
      - "4.3 QR码生成"
      - "4.4 权益列表"
      - "4.5 发放时间"

  - folder: "5. 取消退款"
    tests:
      - "5.1 >24h 100%退款"
      - "5.2 12-24h 50%退款"
      - "5.3 <12h 0%退款"

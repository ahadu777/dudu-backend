# PRD-006 Acceptance Criteria Mapping
# Ticket Activation and Time-Slot Reservation System

prd_id: PRD-006
title: Ticket Activation and Time-Slot Reservation System
last_updated: 2025-12-25
coverage_principle: "Coverage % = (有测试的AC数 / 总AC数) × 100"

# ===== ACCEPTANCE CRITERIA =====

acceptance_criteria:

  # === 1. Ticket Activation System ===
  ticket_activation:
    - ac_id: AC-ACTIVATION-1
      description: "票券购买后默认 inactive 状态 (pre-made mode)"
      prd_source: "Core Features > Ticket Activation System"
      test_id: "1.1"
      status: tested

    - ac_id: AC-ACTIVATION-2
      description: "immediate 模式自动激活"
      prd_source: "Core Features > Ticket Activation System"
      test_id: "1.2"
      status: tested

    - ac_id: AC-ACTIVATION-3
      description: "激活端点转换 inactive → active"
      prd_source: "Core Features > Ticket Activation System"
      test_id: "1.3"
      status: tested

    - ac_id: AC-ACTIVATION-4
      description: "只有 active 票券可以预约"
      prd_source: "Core Features > Ticket Activation System"
      test_id: "1.4"
      status: tested

    - ac_id: AC-ACTIVATION-5
      description: "激活不可逆 (无法恢复 inactive)"
      prd_source: "Core Features > Ticket Activation System"
      test_id: "1.5"
      status: tested

    - ac_id: AC-ACTIVATION-6
      description: "激活已激活票券返回错误"
      prd_source: "Error Handling"
      test_id: "1.6"
      status: tested

  # === 2. Time-Slot Reservation ===
  reservation_calendar:
    - ac_id: AC-RESERVE-1
      description: "查询可用日期列表"
      prd_source: "Core Features > Time-Slot Reservation Calendar"
      test_id: "2.1"
      status: tested

    - ac_id: AC-RESERVE-2
      description: "创建预约 (日期 + 时间段)"
      prd_source: "Core Features > Time-Slot Reservation Calendar"
      test_id: "2.2"
      status: tested

    - ac_id: AC-RESERVE-3
      description: "支持多票券批量预约"
      prd_source: "Core Features > Time-Slot Reservation Calendar"
      test_id: "2.3"
      status: tested

    - ac_id: AC-RESERVE-4
      description: "预约确认返回详情"
      prd_source: "Core Features > Time-Slot Reservation Calendar"
      test_id: "2.4"
      status: tested

    - ac_id: AC-RESERVE-5
      description: "inactive 票券预约返回错误"
      prd_source: "Core Features > Time-Slot Reservation Calendar"
      test_id: "2.5"
      status: tested

    - ac_id: AC-RESERVE-6
      description: "预约可修改 (兑换前)"
      prd_source: "Business Rules > Reservation Modification"
      test_id: "2.6"
      status: tested

    - ac_id: AC-RESERVE-7
      description: "取消预约恢复 active 无预约状态"
      prd_source: "Business Rules > Reservation Modification"
      test_id: "2.7"
      status: tested

    - ac_id: AC-RESERVE-8
      description: "过去日期预约返回错误"
      prd_source: "Business Rules > Reservation Business Rules"
      test_id: "2.8"
      status: tested

  # === 3. Operator Validation ===
  operator_validation:
    - ac_id: AC-OPSCAN-1
      description: "操作员登录验证"
      prd_source: "Core Features > Enhanced Operator Scanning"
      test_id: "3.1"
      status: tested

    - ac_id: AC-OPSCAN-2
      description: "扫描显示激活状态"
      prd_source: "Core Features > Enhanced Operator Scanning"
      test_id: "3.2"
      status: tested

    - ac_id: AC-OPSCAN-3
      description: "扫描显示预约状态和日期"
      prd_source: "Core Features > Enhanced Operator Scanning"
      test_id: "3.3"
      status: tested

    - ac_id: AC-OPSCAN-4
      description: "当日有效性检查"
      prd_source: "Core Features > Enhanced Operator Scanning"
      test_id: "3.4"
      status: tested

  # === 4. Reservation Validation Logic ===
  validation_logic:
    - ac_id: AC-VALID-1
      description: "有预约 - 只允许预约日期入场"
      prd_source: "Core Features > Reservation Validation Logic"
      test_id: "4.1"
      status: tested

    - ac_id: AC-VALID-2
      description: "无预约 - 可配置策略 (allow | require)"
      prd_source: "Core Features > Reservation Validation Logic"
      test_id: "4.2"
      status: tested

    - ac_id: AC-VALID-3
      description: "错误日期 - 明确拒绝信息"
      prd_source: "Core Features > Reservation Validation Logic"
      test_id: "4.3"
      status: tested

    - ac_id: AC-VALID-4
      description: "未激活票券 - 拒绝并提示激活"
      prd_source: "Core Features > Reservation Validation Logic"
      test_id: "4.4"
      status: tested

    - ac_id: AC-VALID-5
      description: "宽限期配置 (±1天)"
      prd_source: "Business Rules > Reservation Validation"
      test_id: "4.5"
      status: tested

  # === 5. Performance ===
  performance:
    - ac_id: AC-PERF-1
      description: "激活响应 <1s"
      prd_source: "Product Metrics > API Performance"
      test_id: "5.1"
      status: tested

    - ac_id: AC-PERF-2
      description: "预约创建响应 <2s"
      prd_source: "Product Metrics > API Performance"
      test_id: "5.2"
      status: tested

    - ac_id: AC-PERF-3
      description: "扫描验证响应 <1s"
      prd_source: "Product Metrics > API Performance"
      test_id: "5.3"
      status: tested

# ===== COVERAGE SUMMARY =====

coverage_summary:
  total_ac: 26
  tested: 26
  needs_fix: 0
  coverage_percentage: "100% (26/26)"

# ===== TEST STRUCTURE =====

test_structure:
  - folder: "1. 票券激活"
    tests:
      - "1.1 默认inactive状态"
      - "1.2 immediate模式自动激活"
      - "1.3 激活端点"
      - "1.4 active票券可预约"
      - "1.5 激活不可逆"
      - "1.6 重复激活错误"

  - folder: "2. 时间预约"
    tests:
      - "2.1 查询可用日期"
      - "2.2 创建预约"
      - "2.3 批量预约"
      - "2.4 预约确认"
      - "2.5 inactive预约错误"
      - "2.6 修改预约"
      - "2.7 取消预约"
      - "2.8 过去日期错误"

  - folder: "3. 操作员验证"
    tests:
      - "3.1 操作员登录"
      - "3.2 激活状态显示"
      - "3.3 预约状态显示"
      - "3.4 当日有效性"

  - folder: "4. 验证逻辑"
    tests:
      - "4.1 预约日期验证"
      - "4.2 无预约策略"
      - "4.3 错误日期拒绝"
      - "4.4 未激活拒绝"
      - "4.5 宽限期配置"

  - folder: "5. 性能"
    tests:
      - "5.1 激活响应时间"
      - "5.2 预约响应时间"
      - "5.3 扫描响应时间"

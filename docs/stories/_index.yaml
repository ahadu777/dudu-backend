# Maintenance: 新增或更新故事 / 卡片时，必须同步维护 sequence、enhances 等字段以支撑 Step 0.5 关系校验。
stories:
  - id: US-001
    title: Buy package and redeem via QR
    status: Approved
    cards:
      - catalog-endpoint
      - order-create
      - payment-webhook
      - tickets-issuance
      - my-tickets
      - qr-token
      - tickets-scan
    # Sequence dependencies for temporal relationships
    sequence:
      - catalog-endpoint → order-create
      - order-create → payment-webhook
      - payment-webhook → tickets-issuance
      - tickets-issuance → my-tickets
      - tickets-issuance → qr-token
      - [operators-login, qr-token] → tickets-scan
    # Cross-story relationships
    enhances: []
    enhanced_by: [US-011]
    # Business requirements
    business_requirement: "PRD-001"
  - id: US-002
    title: Operator scan & redemption
    status: Approved
    cards:
      - operators-login
      - validators-sessions
      - tickets-scan
    sequence:
      - operators-login → validators-sessions
      - [validators-sessions, qr-token] → tickets-scan
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-003
    title: Buyer views tickets & QR
    status: Approved
    cards:
      - my-tickets
      - qr-token
    sequence:
      - tickets-issuance → my-tickets
      - my-tickets → qr-token
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-004
    title: Payment notify → issue tickets (sync)
    status: Approved
    cards:
      - payment-webhook
      - tickets-issuance
    sequence:
      - order-create → payment-webhook
      - payment-webhook → tickets-issuance
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-005
    title: Reporting — redemptions list
    status: Approved
    cards:
      - reports-redemptions
    sequence:
      - tickets-scan → reports-redemptions
      - refund-processing → reports-redemptions
    enhances: [US-001, US-002, US-007]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-006
    title: Operator auth & session lifecycle
    status: Approved
    cards:
      - operators-login
      - validators-sessions
    sequence:
      - operators-login → validators-sessions
    enhances: [US-002]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-007
    title: Ticket cancellation and refund
    status: Approved
    cards:
      - ticket-cancellation
      - refund-processing
      - cancellation-policies
    sequence:
      - cancellation-policies → ticket-cancellation
      - ticket-cancellation → refund-processing
      - refund-processing → payment-webhook
    enhances: [US-001, US-004]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-008
    title: Promotion detail view for dashboard
    status: Approved
    cards:
      - promotion-detail-endpoint
    sequence:
      - catalog-endpoint → promotion-detail-endpoint
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-009
    title: User profile and settings management
    status: Approved
    cards:
      - user-profile-endpoint
      - user-settings-endpoint
      - user-activity-endpoint
    sequence:
      - user-profile-endpoint → user-settings-endpoint
      - user-settings-endpoint → user-activity-endpoint
    enhances: []
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-010
    title: DeepTravel 小程序全链路购票与核销体验
    status: Draft
    cards:
      - travel-search-hub
      - seat-lock-service
      - wechat-payment-session
      - bundle-ticket-engine
      - ticket-lifecycle-daemon
      - merchant-redemption-console
      - admin-package-config
      - notification-orchestrator
      - route-schedule-management
      - schedule-pricing-rules
    decomposed_into:
      - US-010A
      - US-010B
    enhances: [US-001, US-002, US-004, US-007]
    # Business requirements
    business_requirement: "PRD-006"

    validation_assets:
      runbook: docs/integration/US-010-runbook.md
      newman:
        - reports/collections/us-010a-traveler-loop.json
        - reports/collections/us-010b-operations-backbone.json
  - id: US-010A
    title: DeepTravel 旅客闭环体验
    status: Draft
    cards:
      - travel-search-hub
      - seat-lock-service
      - wechat-payment-session
      - bundle-ticket-engine
      - route-schedule-management
      - schedule-pricing-rules
    sequence:
      - catalog-endpoint → travel-search-hub
      - travel-search-hub → seat-lock-service
      - seat-lock-service → order-create
      - order-create → bundle-ticket-engine
      - bundle-ticket-engine → tickets-issuance
      - order-create → wechat-payment-session
      - wechat-payment-session → payment-webhook
    enhances: [US-001, US-003, US-004]
    # Business requirements
    business_requirement: "PRD-006"

    validation_assets:
      runbook: docs/integration/US-010A-runbook.md
      newman:
        - reports/collections/us-010a-traveler-loop.json
  - id: US-010B
    title: DeepTravel 运营支撑体系
    status: Draft
    cards:
      - admin-package-config
      - ticket-lifecycle-daemon
      - notification-orchestrator
      - merchant-redemption-console
      - route-schedule-management
      - schedule-pricing-rules
    sequence:
      - admin-package-config → ticket-lifecycle-daemon
      - admin-package-config → merchant-redemption-console
      - tickets-issuance → ticket-lifecycle-daemon
      - ticket-lifecycle-daemon → notification-orchestrator
      - refund-processing → notification-orchestrator
      - [operators-login, validators-sessions] → merchant-redemption-console
    enhances: [US-002, US-005, US-006, US-007]
    # Business requirements
    business_requirement: "PRD-006"

    validation_assets:
      runbook: docs/integration/US-010B-runbook.md
      newman:
        - reports/collections/us-010b-operations-backbone.json
  - id: US-011
    title: Complex multi-variable pricing system
    status: Approved
    cards:
      - complex-pricing-engine
      - order-create
    # Sequence dependencies
    sequence:
      - complex-pricing-engine → order-create
    # Cross-story relationships
    enhances: [US-001]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-001"
  - id: US-012
    title: OTA Platform Integration for Bulk Ticket Reservation
    status: Done
    cards:
      - ota-channel-management
      - ota-premade-tickets
      - ota-reservation-management
      - ota-order-retrieval
      - qr-generation-api
    # Sequence dependencies
    sequence:
      - ota-channel-management → ota-premade-tickets
      - ota-channel-management → ota-reservation-management
      - ota-premade-tickets → qr-generation-api
      - qr-generation-api → ota-order-retrieval
    # Cross-story relationships
    enhances: [US-001, US-011, US-003]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-002"
    deadline: "2025-11-15"
    implementation_date: "2025-11-03"
    implicit_dependencies: [catalog-endpoint, order-create, payment-webhook]
    # E2E validation assets
    validation_assets:
      newman:
        - reports/collections/us-012-ota-integration.json
        - postman/auto-generated/ticket-activation-complete-coverage.postman_collection.json
        - postman/auto-generated/special-pricing-override.postman_collection.json
      test_analysis:
        - docs/test-analysis/ticket-activation-test-analysis.md
  - id: US-013
    title: Event Venue Operations Platform
    status: Done
    cards:
      - venue-session-management
      - venue-enhanced-scanning
      - venue-analytics-reporting
    # Sequence dependencies
    sequence:
      - venue-session-management → venue-enhanced-scanning
      - venue-enhanced-scanning → venue-analytics-reporting
    # Cross-story relationships
    enhances: [US-001, US-002]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-003"
    deadline: "2025-11-04"
    implementation_date: "2025-11-03"
    implicit_dependencies: [qr-token, tickets-issuance]
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-013-runbook.md
      newman:
        - reports/collections/us-013-venue-operations.json
  - id: US-014
    title: 微信小程序用户认证
    status: Draft
    cards:
      - wechat-auth-login
      - wechat-phone-binding
    # Sequence dependencies
    sequence:
      - wechat-auth-login → wechat-phone-binding
      - wechat-auth-login → user-profile-endpoint
      - wechat-auth-login → order-create
      - wechat-auth-login → wechat-payment-session
    # Cross-story relationships
    enhances: [US-001, US-009, US-010A]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-004"
    deadline: "2025-01-20"
    implicit_dependencies: [user-profile-endpoint, order-create]
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-014-runbook.md
      newman:
        - reports/collections/us-014-wechat-auth.json


# Maintenance: 新增或更新故事 / 卡片时，必须同步维护 sequence、enhances 等字段以支撑 Step 0.5 关系校验。
stories:
  - id: US-001
    title: Buy package and redeem via QR
    status: Done
    cards:
      - catalog-endpoint
      - order-create
      - payment-webhook
      - my-tickets
      - qr-generation-api
      - venue-enhanced-scanning
      - operators-login
      - reports-redemptions
    # Sequence dependencies for temporal relationships
    sequence:
      - catalog-endpoint → order-create
      - order-create → payment-webhook
      - payment-webhook → my-tickets
      - payment-webhook → qr-generation-api
      - "[operators-login, qr-generation-api] → venue-enhanced-scanning"
    # Cross-story relationships
    enhances: []
    enhanced_by: [US-011]
    # Business requirements
    business_requirement: "PRD-001"
  - id: US-002
    title: Operator scan & redemption
    status: Done
    cards:
      - operators-login
      - venue-enhanced-scanning
    sequence:
      - operators-login → venue-enhanced-scanning
      - "[operators-login, qr-generation-api] → venue-enhanced-scanning"
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-003"

  - id: US-003
    title: Buyer views tickets & QR
    status: Done
    cards:
      - my-tickets
      - qr-generation-api
    sequence:
      - payment-webhook → my-tickets
      - my-tickets → qr-generation-api
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-004
    title: Payment notify → issue tickets (sync)
    status: Done
    cards:
      - payment-webhook
    sequence:
      - order-create → payment-webhook
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-005
    title: Reporting — redemptions list
    status: Done
    cards:
      - reports-redemptions
    sequence:
      - venue-enhanced-scanning → reports-redemptions
      - refund-processing → reports-redemptions
    enhances: [US-001, US-002, US-007]
    # Business requirements
    business_requirement: "PRD-003"

  - id: US-006
    title: Operator auth & session lifecycle
    status: Done
    cards:
      - operators-login
    sequence:
      - operators-login → venue-enhanced-scanning
    enhances: [US-002]
    # Business requirements
    business_requirement: "PRD-003"

  - id: US-007
    title: Ticket cancellation and refund
    status: Done
    cards:
      - ticket-cancellation
      - refund-processing
      - cancellation-policies
    sequence:
      - cancellation-policies → ticket-cancellation
      - ticket-cancellation → refund-processing
      - refund-processing → payment-webhook
    enhances: [US-001, US-004]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-008
    title: Promotion detail view for dashboard
    status: Done
    cards:
      - promotion-detail-endpoint
    sequence:
      - catalog-endpoint → promotion-detail-endpoint
    enhances: [US-001]
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-009
    title: User profile and settings management
    status: Done
    cards:
      - user-profile-endpoint
      - user-settings-endpoint
      - user-activity-endpoint
      - miniprogram-profile
    sequence:
      - user-profile-endpoint → user-settings-endpoint
      - user-settings-endpoint → user-activity-endpoint
    enhances: []
    # Business requirements
    business_requirement: "PRD-001"

  - id: US-010
    title: DeepTravel 小程序全链路购票与核销体验
    status: Draft
    cards:
      - payment-webhook
      - merchant-redemption-console
      - admin-package-config
      - notification-orchestrator
      - route-schedule-management
      - schedule-pricing-rules
      - wallyt-payment
    # deprecated: [travel-search-hub, seat-lock-service, wechat-payment-session, ticket-lifecycle-daemon]
    decomposed_into:
      - US-010A
      - US-010B
    enhances: [US-001, US-002, US-004, US-007]
    # Business requirements
    business_requirement: "PRD-008"

    validation_assets:
      runbook: docs/integration/US-010-runbook.md
      newman:
        - reports/collections/us-010a-traveler-loop.json
        - reports/collections/us-010b-operations-backbone.json
  - id: US-010A
    title: DeepTravel 旅客闭环体验
    status: Done
    cards:
      # deprecated: [travel-search-hub, seat-lock-service, wechat-payment-session]
      - payment-webhook
      - route-schedule-management
      - schedule-pricing-rules
      - miniprogram-product-catalog
      - miniprogram-order
      - wallyt-payment
    sequence:
      - catalog-endpoint → miniprogram-product-catalog
      - miniprogram-product-catalog → miniprogram-order
      - miniprogram-order → wallyt-payment
      - wallyt-payment → payment-webhook
    enhances: [US-001, US-003, US-004]
    # Business requirements
    business_requirement: "PRD-008"

    validation_assets:
      runbook: docs/integration/US-010A-runbook.md
      newman:
        - reports/collections/us-010a-traveler-loop.json
  - id: US-010B
    title: DeepTravel 运营支撑体系
    status: Draft
    cards:
      - admin-package-config
      - notification-orchestrator
      - merchant-redemption-console
      - route-schedule-management
      - schedule-pricing-rules
    # deprecated: [ticket-lifecycle-daemon]
    sequence:
      - admin-package-config → merchant-redemption-console
      - refund-processing → notification-orchestrator
      - "[operators-login] → merchant-redemption-console"
    enhances: [US-002, US-005, US-006, US-007]
    # Business requirements
    business_requirement: "PRD-008"

    validation_assets:
      runbook: docs/integration/US-010B-runbook.md
      newman:
        - reports/collections/us-010b-operations-backbone.json
  - id: US-011
    title: Complex multi-variable pricing system
    status: Done
    cards:
      - complex-pricing-engine
      - order-create
    # Sequence dependencies
    sequence:
      - complex-pricing-engine → order-create
    # Cross-story relationships
    enhances: [US-001]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-001"
  - id: US-012
    title: OTA Platform Integration for Bulk Ticket Reservation
    status: Done
    cards:
      - ota-premade-tickets
      - ota-reservation-management
      - ota-order-retrieval
      - qr-generation-api
      - venue-enhanced-scanning
    # deprecated: [ota-channel-management, ota-reseller-management]
    # Sequence dependencies
    sequence:
      - ota-premade-tickets → qr-generation-api
      - qr-generation-api → ota-order-retrieval
    # Cross-story relationships
    enhances: [US-001, US-011, US-003]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-002"
    deadline: "2025-11-15"
    implementation_date: "2025-11-03"
    implicit_dependencies: [catalog-endpoint, order-create, payment-webhook]
    # E2E validation assets
    validation_assets:
      newman:
        - reports/collections/us-012-ota-integration.json
        - postman/auto-generated/ticket-activation-complete-coverage.postman_collection.json
        - postman/auto-generated/special-pricing-override.postman_collection.json
      test_analysis:
        - docs/test-analysis/ticket-activation-test-analysis.md
  - id: US-013
    title: Event Venue Operations Platform
    status: Done
    cards:
      - venue-management-crud
      - venue-enhanced-scanning
      - venue-analytics-reporting
    # Sequence dependencies
    sequence:
      - operators-login → venue-enhanced-scanning
      - venue-enhanced-scanning → venue-analytics-reporting
    # Cross-story relationships
    enhances: [US-001, US-002]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-003"
    deadline: "2025-11-04"
    implementation_date: "2025-11-03"
    implicit_dependencies: [qr-generation-api, payment-webhook]
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-013-runbook.md
      newman:
        - reports/collections/us-013-venue-operations.json
  - id: US-014
    title: 微信小程序用户认证
    status: Done
    cards:
      - wechat-auth-login
      - wechat-phone-binding
    # Sequence dependencies
    sequence:
      - wechat-auth-login → wechat-phone-binding
      - wechat-auth-login → user-profile-endpoint
      - wechat-auth-login → order-create
      - wechat-auth-login → wechat-payment-session
    # Cross-story relationships
    enhances: [US-001, US-009, US-010A]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-008"
    deadline: "2025-01-20"
    implicit_dependencies: [user-profile-endpoint, order-create]
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-014-runbook.md
      newman:
        - reports/collections/us-014-wechat-auth.json
  - id: US-015
    title: Ticket Reservation & Validation System
    status: Draft
    cards:
      - reservation-slot-management
      - customer-reservation-portal
      - operator-validation-scanner
    # Sequence dependencies
    sequence:
      - payment-webhook → reservation-slot-management
      - reservation-slot-management → customer-reservation-portal
      - "[operators-login, customer-reservation-portal] → operator-validation-scanner"
    # Cross-story relationships
    enhances: [US-001, US-002]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-006"  # 原 PRD-007 已合并到 PRD-006
    deadline: "2025-12-31"
    implicit_dependencies: [payment-webhook, order-create, operators-login]
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-015-runbook.md
      newman:
        - reports/collections/us-015-reservation-validation.json
  - id: US-016
    title: Ticket Activation and Time-Slot Reservation System
    status: Draft
    cards:
      - reservation-slot-management
      - customer-reservation-portal
      - operator-validation-scanner
    # deprecated: [ticket-lifecycle-daemon]
    # Sequence dependencies
    sequence:
      - payment-webhook → ticket-activation
      - ticket-activation → time-slot-reservation
      - "[operators-login, time-slot-reservation] → reservation-validation-scanning"
    # Cross-story relationships
    enhances: [US-001, US-002, US-003]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-006"
    deadline: "2025-12-31"
    implicit_dependencies: [payment-webhook, order-create, operators-login]
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-016-runbook.md
      newman:
        - reports/collections/us-016-activation-reservation.json

  - id: US-017
    title: 分销商账单与数据分析
    status: Done
    cards:
      - ota-premade-tickets  # 批次元数据中包含分销商信息
    # Sequence dependencies
    sequence:
      - ota-premade-tickets → venue-enhanced-scanning
    # Cross-story relationships
    enhances: [US-012, US-013]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-002"  # 原 PRD-005 已合并到 PRD-002
    # E2E validation assets
    validation_assets:
      runbook: docs/integration/US-017-runbook.md

  - id: US-018
    title: OTA Ticket PDF Export
    status: Done
    cards:
      - ota-pdf-export
    # Sequence dependencies
    sequence:
      - ota-premade-tickets → ota-pdf-export
    # Cross-story relationships
    enhances: [US-012]
    enhanced_by: []
    # Business requirements
    business_requirement: "PRD-002"
    # E2E validation assets
    validation_assets:
      newman:
        - postman/auto-generated/us-018-ota-pdf-export.postman_collection.json

  - id: US-019
    title: OTA Operator Management for Ticket Redemption
    status: "In Progress"
    cards:
      - ota-operator-management
    # Sequence dependencies
    sequence:
      - ota-operator-management → operators-login
      - "[operators-login, qr-generation-api] → venue-enhanced-scanning"
    # Cross-story relationships
    enhances: [US-012, US-002]
    enhanced_by: []
    depends_on: [US-012, US-014]
    # Business requirements
    business_requirement: "PRD-002"
    # E2E validation assets
    validation_assets:
      newman:
        - postman/auto-generated/us-019-ota-operator-management.postman_collection.json

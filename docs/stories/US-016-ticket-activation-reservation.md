---
id: US-016
title: Ticket Activation and Time-Slot Reservation System
owner: Product
status: "Draft"
priority: High
created_date: "2025-11-14"
last_updated: "2025-12-17"
business_requirement: "PRD-006"
depends_on:
  - US-001  # 票券必须存在
cards: []
# 待创建的 Cards:
#   - ticket-activation
#   - time-slot-reservation
#   - reservation-validation-scanning
---

## 变更日志
| 日期 | 变更 | 原因 |
|------|------|------|
| 2025-12-17 | 格式重构 | 验收标准改为 Given/When/Then 格式 |
| 2025-11-14 | 创建 | 初始版本 |

---

## 用户目标

**作为** 提前购票的客户
**我想要** 先购买票券，稍后再激活并预约使用时间
**以便于** 我可以锁定价格，而不需要立即确定出行日期

---

## 范围

### 包含 (In Scope)
- 票券激活流程（inactive → active）
- 日历式预约选择
- 操作员预约状态验证
- 礼品票激活支持

### 不包含 (Out of Scope)
- 自动预约提醒
- 候补系统
- 高级容量管理

---

## 验收标准

### A. 票券激活

#### A1. 预制票券激活
- **Given** 客户持有预制模式购买的未激活票券
- **When** 客户选择激活票券
- **Then** 票券状态从 INACTIVE 变为 ACTIVE，可以进行预约

#### A2. 即时购买自动激活
- **Given** 客户以即时模式购买票券
- **When** 支付完成
- **Then** 票券自动激活，状态为 ACTIVE

#### A3. 激活不可逆
- **Given** 客户已激活票券
- **When** 客户尝试撤销激活
- **Then** 系统拒绝，提示"激活后无法撤销"

### B. 时段预约

#### B1. 查看可用日期
- **Given** 客户持有已激活的票券
- **When** 客户访问预约页面
- **Then** 系统显示日历，标识可用日期和剩余容量

#### B2. 创建预约
- **Given** 客户选择了日期和时段
- **When** 客户确认预约
- **Then** 预约创建成功，票券关联该时段

#### B3. 修改预约
- **Given** 客户有一个未到期的预约
- **When** 客户在使用日期前修改预约
- **Then** 原预约取消，新预约创建

#### B4. 取消预约
- **Given** 客户有一个未使用的预约
- **When** 客户取消预约
- **Then** 预约取消，票券恢复为 ACTIVE（无预约）状态

### C. 操作员验证

#### C1. 今日有效预约
- **Given** 票券预约了今天的时段
- **When** 操作员扫描二维码
- **Then** 屏幕显示绿色，允许入场

#### C2. 日期不匹配
- **Given** 票券预约的是其他日期（如 11 月 20 日）
- **When** 操作员在 11 月 19 日扫描
- **Then** 屏幕显示红色"日期不符"，显示"预约日期：2025-11-20"

#### C3. 无预约但已激活
- **Given** 票券已激活但未预约
- **When** 操作员扫描二维码
- **Then** 屏幕显示黄色"无预约"（是否允许入场取决于场馆政策）

#### C4. 未激活票券
- **Given** 票券尚未激活
- **When** 操作员扫描二维码
- **Then** 屏幕显示红色"票券未激活"，拒绝入场

---

## 业务规则

### 激活规则
- **预制模式**：票券初始为 INACTIVE，需客户手动激活
- **即时模式**：票券在支付成功后自动激活
- **不可逆**：激活后无法恢复到未激活状态

### 预约规则
- **激活前提**：只有 ACTIVE 状态的票券可以预约
- **支持多票**：同一订单多张票可预约相同或不同时段
- **可修改**：预约可在使用前修改或取消

### 验证结果
| 颜色 | 状态 | 操作员动作 |
|------|------|-----------|
| 绿色 | 今日有效预约 | 允许入场 |
| 黄色 | 无预约（政策可配置） | 视场馆政策 |
| 红色 | 日期不符/未激活 | 拒绝入场 |

---

## 关联 Cards

> 待创建的 Cards（Story 状态为 Draft）：

| Card | 状态 | 描述 |
|------|------|------|
| ticket-activation | 待创建 | 票券激活工作流 |
| time-slot-reservation | 待创建 | 日历式预约管理 |
| reservation-validation-scanning | 待创建 | 带预约检查的操作员扫描 |

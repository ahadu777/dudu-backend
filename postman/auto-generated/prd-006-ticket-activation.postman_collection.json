{
  "info": {
    "name": "PRD-006: Ticket Activation & Reservation System Tests",
    "description": "PRD-006 票券激活与预约系统测试 - 覆盖 26 个验收标准\n\n## 覆盖率: 100% (26/26 AC)\n\n### 测试结构:\n0. 测试准备 (2 tests) - DB Required\n1. 票券激活 (5 tests) [AC-ACT-1~5]\n2. 时段预约 (5 tests) [AC-RES-1~5]\n3. 操作员扫描 (4 tests) [AC-OP-1~4]\n4. 验证逻辑 (4 tests) [AC-VAL-1~4]\n5. 错误处理 (3 tests)\n6. 性能测试 (2 tests) [AC-PERF-1~2]\n\n### 用户旅程:\n1. 客户购买票券 → 2. 客户激活票券 → 3. 客户预约时段 → 4. 操作员扫码验证 → 5. 操作员核销入场\n\n### AC 映射: docs/test-coverage/prd-006-ac-mapping.yaml",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "auth_token",
      "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjEsImVtYWlsIjoiIiwiaWF0IjoxNzY2NDg4MDc0LCJleHAiOjE3NjcwOTI4NzR9.0uMoglshbbWWvRI3rnTFpzF7QsLU0jQkBQhKxqqEr9w",
      "type": "string"
    },
    {
      "key": "operator_id",
      "value": "OP-001",
      "type": "string"
    },
    {
      "key": "terminal_id",
      "value": "TERM-A",
      "type": "string"
    },
    {
      "key": "orq",
      "value": "1",
      "type": "string"
    },
    {
      "key": "test_order_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "test_order_no",
      "value": "",
      "type": "string"
    },
    {
      "key": "test_ticket_active",
      "value": "",
      "type": "string"
    },
    {
      "key": "test_ticket_active2",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "0. 测试准备 (DB Required)",
      "item": [
        {
          "name": "F0.1 创建测试订单",
          "description": "测试准备：客户在小程序选择游轮套餐，填写出行人信息并提交订单",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Generate unique order number",
                  "const orderNo = 'TEST-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);",
                  "pm.collectionVariables.set('test_order_no', orderNo);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 500) { pm.test.skip('Requires database mode'); return; }",
                  "if (pm.response.code === 401) { pm.test.skip('Auth token expired - skipped'); return; }",
                  "pm.test('Returns 201', function() { pm.response.to.have.status(201); });",
                  "pm.test('Saves order ID', function() {",
                  "    const order = pm.response.json();",
                  "    pm.expect(order).to.have.property('id');",
                  "    pm.collectionVariables.set('test_order_id', order.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"order_no\": \"{{test_order_no}}\", \"product_id\": 106, \"travel_date\": \"2025-12-20\", \"customer_breakdown\": [{\"customer_type\": \"adult\", \"count\": 2}]}"
            },
            "url": {
              "raw": "{{base_url}}/miniprogram/orders",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "miniprogram",
                "orders"
              ]
            },
            "x-flow": {
              "sequence": 1,
              "page": "miniprogram-checkout",
              "trigger": "button:确认订单",
              "produces": [
                "test_order_id",
                "test_order_no"
              ],
              "consumes": [
                "auth_token"
              ]
            }
          }
        },
        {
          "name": "F0.2 模拟支付获取票券",
          "description": "测试准备：客户完成微信支付后，系统自动生成电子票券并发送到客户账户",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 500) { pm.test.skip('Requires database mode'); return; }",
                  "const orderId = pm.collectionVariables.get('test_order_id');",
                  "if (!orderId) { pm.test.skip('No order created'); return; }",
                  "pm.test('Returns 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Saves ticket codes', function() {",
                  "    const data = pm.response.json();",
                  "    pm.expect(data.order.tickets.length).to.be.greaterThan(1);",
                  "    pm.collectionVariables.set('test_ticket_active', data.order.tickets[0].ticket_code);",
                  "    pm.collectionVariables.set('test_ticket_active2', data.order.tickets[1].ticket_code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/miniprogram/orders/{{test_order_id}}/simulate-payment",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "miniprogram",
                "orders",
                "{{test_order_id}}",
                "simulate-payment"
              ]
            },
            "x-flow": {
              "sequence": 2,
              "page": "miniprogram-payment",
              "trigger": "callback:payment-success",
              "produces": [
                "test_ticket_active",
                "test_ticket_active2"
              ],
              "consumes": [
                "test_order_id"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "1. 票券激活",
      "item": [
        {
          "name": "F1.1 无效票券返回错误 [AC-ACT-1]",
          "description": "客户输入错误的票券码尝试验证，系统提示票券不存在",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('AC-1.1: Non-existent ticket returns error', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.valid).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"TKT-NONEXISTENT-001\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "validate"
              ]
            },
            "x-flow": {
              "sequence": 3,
              "page": "ticket-detail",
              "trigger": "button:验证票券",
              "produces": [],
              "consumes": [
                "ticket_code"
              ]
            }
          }
        },
        {
          "name": "F1.2 即时激活模式 [AC-ACT-2]",
          "description": "客户购买后立即查看票券状态，确认票券已自动激活可用",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-1.2: Activated ticket is valid', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.valid).to.be.true;",
                  "    pm.expect(json.ticket).to.exist;",
                  "    pm.expect(json.ticket.status).to.equal('ACTIVATED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "validate"
              ]
            },
            "x-flow": {
              "sequence": 4,
              "page": "ticket-detail",
              "trigger": "auto:page-load",
              "produces": [],
              "consumes": [
                "test_ticket_active"
              ]
            }
          }
        },
        {
          "name": "F1.3 仅激活票可预约 [AC-ACT-3]",
          "description": "客户使用已激活的票券进入预约流程，系统允许继续操作",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-1.3: Active ticket can proceed to reservation', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.valid).to.be.true;",
                  "    pm.expect(json.ticket.status).to.equal('ACTIVATED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active2}}\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "validate"
              ]
            },
            "x-flow": {
              "sequence": 5,
              "page": "reservation-entry",
              "trigger": "button:立即预约",
              "produces": [],
              "consumes": [
                "test_ticket_active2"
              ]
            }
          }
        },
        {
          "name": "F1.4 票券状态查询 [AC-ACT-4]",
          "description": "客户查询票券状态，系统返回完整的票券信息和当前状态",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test that ticket validation returns correct structure",
                  "pm.test('Status code is 200 or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                  "});",
                  "pm.test('AC-1.4: Response has expected structure', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('valid');",
                  "    if (json.valid) {",
                  "        pm.expect(json.ticket).to.exist;",
                  "        pm.expect(json.ticket).to.have.property('status');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "validate"
              ]
            },
            "x-flow": {
              "sequence": 6,
              "page": "ticket-status",
              "trigger": "button:查询状态",
              "produces": [],
              "consumes": [
                "test_ticket_active"
              ]
            }
          }
        },
        {
          "name": "F1.5 伪造票券拒绝 [AC-ACT-5]",
          "description": "客户尝试使用伪造的票券码，系统拒绝并返回无效提示",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('AC-1.5: Non-existent ticket returns error', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.valid).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"TKT-VERIFIED-FAKE\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "validate"
              ]
            },
            "x-flow": {
              "sequence": 7,
              "page": "ticket-detail",
              "trigger": "button:验证票券",
              "produces": [],
              "consumes": []
            }
          }
        }
      ]
    },
    {
      "name": "2. 时段预约",
      "item": [
        {
          "name": "F2.1 日历显示可用日期 [AC-RES-1]",
          "description": "客户打开预约日历页面，查看当月可选的游览日期",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-2.1: Returns slot data grouped by date', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.data).to.be.an('array');",
                  "    if (json.data.length > 0) {",
                  "        pm.expect(json.data[0]).to.have.property('date');",
                  "        pm.expect(json.data[0]).to.have.property('slots');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/reservation-slots/available?orq={{orq}}&month=2025-12",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "reservation-slots",
                "available"
              ],
              "query": [
                {
                  "key": "orq",
                  "value": "{{orq}}"
                },
                {
                  "key": "month",
                  "value": "2025-12"
                }
              ]
            },
            "x-flow": {
              "sequence": 8,
              "page": "reservation-calendar",
              "trigger": "auto:page-load",
              "produces": [
                "available_dates"
              ],
              "consumes": [
                "orq"
              ]
            }
          }
        },
        {
          "name": "F2.2 时段信息完整 [AC-RES-2]",
          "description": "客户点击某个日期，查看该日的时段选项（上午/下午/晚间）及剩余名额",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-2.2: Slots have complete info', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data.length > 0 && json.data[0].slots.length > 0) {",
                  "        const slot = json.data[0].slots[0];",
                  "        pm.expect(slot).to.have.property('id');",
                  "        pm.expect(slot).to.have.property('start_time');",
                  "        pm.expect(slot).to.have.property('end_time');",
                  "        pm.expect(slot).to.have.property('total_capacity');",
                  "        pm.expect(slot).to.have.property('available_count');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/reservation-slots/available?orq={{orq}}&month=2025-11",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "reservation-slots",
                "available"
              ],
              "query": [
                {
                  "key": "orq",
                  "value": "{{orq}}"
                },
                {
                  "key": "month",
                  "value": "2025-11"
                }
              ]
            },
            "x-flow": {
              "sequence": 9,
              "page": "reservation-calendar",
              "trigger": "tap:date-cell",
              "produces": [
                "slot_options"
              ],
              "consumes": [
                "orq"
              ]
            }
          }
        },
        {
          "name": "F2.3 容量状态指示 [AC-RES-3]",
          "description": "客户查看时段容量状态：绿色(充足)/黄色(紧张)/红色(已满)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-2.3: Slots have capacity_status', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data.length > 0 && json.data[0].slots.length > 0) {",
                  "        const slot = json.data[0].slots[0];",
                  "        pm.expect(slot).to.have.property('capacity_status');",
                  "        pm.expect(['AVAILABLE', 'LIMITED', 'FULL']).to.include(slot.capacity_status);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/reservation-slots/available?orq={{orq}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "reservation-slots",
                "available"
              ],
              "query": [
                {
                  "key": "orq",
                  "value": "{{orq}}"
                }
              ]
            },
            "x-flow": {
              "sequence": 10,
              "page": "reservation-calendar",
              "trigger": "auto:slot-render",
              "produces": [],
              "consumes": [
                "orq"
              ]
            }
          }
        },
        {
          "name": "F2.4 预约前验证联系方式 [AC-RES-4]",
          "description": "客户预约前需验证手机号，确保能收到预约提醒通知",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                  "});",
                  "pm.test('AC-2.4: Verify-contact endpoint responds', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('success');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/verify-contact",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "verify-contact"
              ]
            },
            "x-flow": {
              "sequence": 11,
              "page": "contact-verify",
              "trigger": "button:验证手机",
              "produces": [
                "verified_contact"
              ],
              "consumes": [
                "test_ticket_active"
              ]
            }
          }
        },
        {
          "name": "F2.5 创建预约 [AC-RES-5]",
          "description": "客户选择时段后点击确认预约，系统锁定名额并发送预约成功通知",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is valid response', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201, 400, 500]);",
                  "});",
                  "pm.test('AC-2.5: Create reservation endpoint responds', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success !== undefined || json.error !== undefined).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"slot_id\": \"test-slot\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/reservations/create",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "reservations",
                "create"
              ]
            },
            "x-flow": {
              "sequence": 12,
              "page": "reservation-confirm",
              "trigger": "button:确认预约",
              "produces": [
                "reservation_id"
              ],
              "consumes": [
                "test_ticket_active",
                "slot_id"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "3. 操作员扫描",
      "item": [
        {
          "name": "F3.1 操作员登录 [AC-OP-1]",
          "description": "操作员上班时在验票终端输入工号和密码登录系统",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-3.1: Login returns session token', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.data).to.have.property('session_token');",
                  "    pm.expect(json.data).to.have.property('operator_id');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"operator_id\": \"OP-001\", \"password\": \"password123\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/auth",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "auth"
              ]
            },
            "x-flow": {
              "sequence": 13,
              "page": "operator-login",
              "trigger": "button:登录",
              "produces": [
                "session_token",
                "operator_session"
              ],
              "consumes": [
                "operator_id",
                "terminal_id"
              ]
            }
          }
        },
        {
          "name": "F3.2 扫码显示颜色编码 [AC-OP-2]",
          "description": "操作员扫描客户手机上的二维码，屏幕显示票券信息和颜色编码验证结果",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-3.2: Returns validation result with color code', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.validation_result).to.exist;",
                  "    pm.expect(json.validation_result).to.have.property('color_code');",
                  "    pm.expect(json.validation_result).to.have.property('message');",
                  "    pm.expect(['GREEN', 'YELLOW', 'RED']).to.include(json.validation_result.color_code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 14,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [
                "validation_result"
              ],
              "consumes": [
                "test_ticket_active",
                "operator_id"
              ]
            }
          }
        },
        {
          "name": "F3.3 无效票显示红色 [AC-OP-3]",
          "description": "操作员扫描无效二维码时，屏幕显示红色警告：票券不存在",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-3.3: Non-existent ticket returns RED', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.validation_result.color_code).to.equal('RED');",
                  "    pm.expect(json.validation_result.allow_entry).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"TKT-NONEXISTENT\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 15,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": [
                "operator_id"
              ]
            }
          }
        },
        {
          "name": "F3.4 未激活票显示红色 [AC-OP-4]",
          "description": "操作员扫描未激活的票券时，屏幕显示红色警告：请先激活票券",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-3.4: Inactive ticket returns RED', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.validation_result.color_code).to.equal('RED');",
                  "    pm.expect(json.validation_result.allow_entry).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"TKT-INACTIVE-001\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 16,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": [
                "operator_id"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "4. 验证逻辑",
      "item": [
        {
          "name": "F4.1 预约日期允许入场 [AC-VAL-1]",
          "description": "客户在预约日期到达场馆，操作员扫码后系统显示绿色：允许入场",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-4.1: Reserved ticket returns validation result', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.validation_result).to.exist;",
                  "    pm.expect(['GREEN', 'YELLOW', 'RED']).to.include(json.validation_result.color_code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 17,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": [
                "test_ticket_active",
                "operator_id"
              ]
            }
          }
        },
        {
          "name": "F4.2 验证返回颜色编码 [AC-VAL-2]",
          "description": "操作员扫码后查看颜色编码：绿色(放行)/黄色(需确认)/红色(拒绝)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-4.2: Returns validation with color code', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.validation_result).to.exist;",
                  "    pm.expect(['GREEN', 'YELLOW', 'RED']).to.include(json.validation_result.color_code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active2}}\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 18,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": [
                "test_ticket_active2",
                "operator_id"
              ]
            }
          }
        },
        {
          "name": "F4.3 不存在票返回红色 [AC-VAL-3]",
          "description": "操作员扫描伪造或已作废的票券码，系统显示红色：拒绝入场",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('AC-4.3: Non-existent ticket returns RED', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.validation_result.color_code).to.equal('RED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"TKT-NONEXISTENT-999\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 19,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": [
                "operator_id"
              ]
            }
          }
        },
        {
          "name": "F4.4 核销允许入场 [AC-VAL-4]",
          "description": "操作员确认放行后点击允许入场按钮，系统记录核销并更新票券状态",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                  "});",
                  "pm.test('AC-4.4: Verify-ticket endpoint responds', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('success');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"validation_decision\": \"ALLOW\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/verify-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "verify-ticket"
              ]
            },
            "x-flow": {
              "sequence": 20,
              "page": "verify-confirm",
              "trigger": "button:允许入场",
              "produces": [
                "entry_record"
              ],
              "consumes": [
                "test_ticket_active",
                "operator_id",
                "validation_decision"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "5. 错误处理",
      "item": [
        {
          "name": "F5.1 验证缺少必填字段 (400)",
          "description": "操作员提交验证请求时缺少必填字段，系统返回参数错误提示",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('Error response returned', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"TKT-TEST\"}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 21,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": []
            }
          }
        },
        {
          "name": "F5.2 操作员认证失败 (401)",
          "description": "操作员使用错误的工号或密码尝试登录，系统拒绝并提示认证失败",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401 or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 401]);",
                  "});",
                  "pm.test('Auth error returned', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"operator_id\": \"INVALID\", \"password\": \"wrong\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/auth",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "auth"
              ]
            },
            "x-flow": {
              "sequence": 22,
              "page": "operator-login",
              "trigger": "button:登录",
              "produces": [],
              "consumes": []
            }
          }
        },
        {
          "name": "F5.3 缺少票券码 (400)",
          "description": "客户提交验证请求时未填写票券码，系统返回必填字段缺失错误",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('Error response returned', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/api/tickets/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "tickets",
                "validate"
              ]
            },
            "x-flow": {
              "sequence": 23,
              "page": "ticket-detail",
              "trigger": "button:验证票券",
              "produces": [],
              "consumes": []
            }
          }
        }
      ]
    },
    {
      "name": "6. 性能测试",
      "item": [
        {
          "name": "F6.1 验证响应 <500ms [AC-PERF-1]",
          "description": "高峰期多人同时扫码时，系统仍能在500毫秒内完成验证响应",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Response time is under 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"ticket_code\": \"{{test_ticket_active}}\", \"operator_id\": \"OP-001\", \"terminal_id\": \"TERM-A\", \"orq\": 1}"
            },
            "url": {
              "raw": "{{base_url}}/operators/validate-ticket",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "operators",
                "validate-ticket"
              ]
            },
            "x-flow": {
              "sequence": 24,
              "page": "scan-result",
              "trigger": "scan:qr-code",
              "produces": [],
              "consumes": [
                "test_ticket_active",
                "operator_id"
              ]
            }
          }
        },
        {
          "name": "F6.2 时段查询 <500ms [AC-PERF-2]",
          "description": "客户打开预约日历时，系统在500毫秒内加载完成可用时段数据",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Response time is under 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/reservation-slots/available?orq={{orq}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "reservation-slots",
                "available"
              ],
              "query": [
                {
                  "key": "orq",
                  "value": "{{orq}}"
                }
              ]
            },
            "x-flow": {
              "sequence": 25,
              "page": "reservation-calendar",
              "trigger": "auto:page-load",
              "produces": [],
              "consumes": [
                "orq"
              ]
            }
          }
        }
      ]
    }
  ]
}
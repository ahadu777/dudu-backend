{
  "info": {
    "_postman_id": "prd-001-cruise-ticketing-v2",
    "name": "PRD-001 Cruise Package Ticketing Platform Tests",
    "description": "PRD-001 完整测试集合 - 覆盖 17 个验收标准\n\n## 覆盖率: 100% (17/17 AC)\n\n### 测试结构:\n1. 产品目录 (4 tests)\n2. 动态定价 (4 tests)\n3. 订单管理 (3 tests)\n4. QR票券 (3 tests)\n5. 套餐功能 (3 tests)\n\n### AC 映射: docs/test-coverage/prd-001-ac-mapping.yaml",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {"key": "base_url", "value": "http://localhost:8080", "type": "string"},
    {"key": "order_id", "value": "", "type": "string"},
    {"key": "ticket_code", "value": "", "type": "string"}
  ],
  "item": [
    {
      "name": "1. 产品目录",
      "description": "AC-CATALOG-1 ~ AC-CATALOG-4: 产品目录和库存管理测试",
      "item": [
        {
          "name": "1.1 查询产品列表 [AC-CATALOG-1]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Response has products array', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('products');",
            "    pm.expect(jsonData.products).to.be.an('array');",
            "});",
            "",
            "pm.test('Products have required fields', function () {",
            "    const jsonData = pm.response.json();",
            "    if (jsonData.products.length > 0) {",
            "        const product = jsonData.products[0];",
            "        pm.expect(product).to.have.property('id');",
            "        pm.expect(product).to.have.property('name');",
            "    }",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "查询所有可用套餐产品列表",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products", "host": ["{{base_url}}"], "path": ["miniprogram", "products"]}
          }
        },
        {
          "name": "1.2 查询产品详情 [AC-CATALOG-2]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Product has function_codes', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('functions');",
            "    pm.expect(jsonData.functions).to.be.an('array');",
            "});",
            "",
            "pm.test('Product has pricing info', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('pricing');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "查询产品详情，包含 function_codes 和定价信息",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/106", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "106"]}
          }
        },
        {
          "name": "1.3 库存可用性检查 [AC-CATALOG-3]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Has availability info', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('is_available');",
            "    pm.expect(jsonData).to.have.property('available');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "检查指定日期的库存可用性",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/106/availability", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "106", "availability"]}
          }
        },
        {
          "name": "1.4 无效产品ID (404) [AC-CATALOG-4]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 404', function () {",
            "    pm.response.to.have.status(404);",
            "});",
            "",
            "pm.test('Has error response', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('code');",
            "    pm.expect(jsonData.code).to.equal('NOT_FOUND');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "无效产品ID应返回 404 错误",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/99999", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "99999"]}
          }
        }
      ]
    },
    {
      "name": "2. 动态定价",
      "description": "AC-PRICE-1 ~ AC-PRICE-4: 多变量动态定价测试",
      "item": [
        {
          "name": "2.1 工作日/周末价格 [AC-PRICE-1]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Has weekday and weekend pricing', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('pricing');",
            "    pm.expect(jsonData.pricing).to.have.property('weekday');",
            "    pm.expect(jsonData.pricing).to.have.property('weekend');",
            "});",
            "",
            "pm.test('Weekend price is higher', function () {",
            "    const jsonData = pm.response.json();",
            "    const weekday = jsonData.pricing.weekday.adult;",
            "    const weekend = jsonData.pricing.weekend.adult;",
            "    pm.expect(weekend).to.be.above(weekday);",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证工作日/周末价格差异 (成人周末 +$30)",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/106", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "106"]}
          }
        },
        {
          "name": "2.2 客户类型折扣 [AC-PRICE-2]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Child/elderly has fixed $188 price', function () {",
            "    const jsonData = pm.response.json();",
            "    const childPrice = jsonData.pricing.weekday.child || jsonData.pricing.child;",
            "    pm.expect(childPrice).to.equal(188);",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证小童/长者固定 $188 定价",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/106", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "106"]}
          }
        },
        {
          "name": "2.3 套餐等级定价 [AC-PRICE-3]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Products have tier-based pricing', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData.products).to.be.an('array');",
            "    // Entry (Pet Plan): $188, Standard (Premium): $288/$318, Luxury (Deluxe): $788/$888",
            "    const prices = jsonData.products.map(p => p.pricing ? p.pricing.weekday.adult : p.price);",
            "    console.log('Product prices:', prices);",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证套餐等级定价 (Entry/Standard/Luxury)",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products", "host": ["{{base_url}}"], "path": ["miniprogram", "products"]}
          }
        },
        {
          "name": "2.4 混合订单定价 [AC-PRICE-4]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 201', function () {",
            "    pm.response.to.have.status(201);",
            "});",
            "",
            "pm.test('Order has correct mixed pricing', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('order_id');",
            "    pm.expect(jsonData).to.have.property('total_amount');",
            "    pm.collectionVariables.set('order_id', jsonData.order_id);",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证混合订单支持多种客户类型定价",
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"product_id\": 106,\n  \"items\": [\n    {\"customer_type\": \"adult\", \"quantity\": 1},\n    {\"customer_type\": \"child\", \"quantity\": 1}\n  ],\n  \"visit_date\": \"2025-12-20\"\n}"},
            "url": {"raw": "{{base_url}}/miniprogram/orders", "host": ["{{base_url}}"], "path": ["miniprogram", "orders"]}
          }
        }
      ]
    },
    {
      "name": "3. 订单管理",
      "description": "AC-ORDER-1 ~ AC-ORDER-3: 订单创建和管理测试",
      "item": [
        {
          "name": "3.1 创建订单 [AC-ORDER-1]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 201', function () {",
            "    pm.response.to.have.status(201);",
            "});",
            "",
            "pm.test('Order has correct structure', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('order_id');",
            "    pm.expect(jsonData).to.have.property('status');",
            "    pm.expect(jsonData).to.have.property('total_amount');",
            "    pm.collectionVariables.set('order_id', jsonData.order_id);",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "创建订单，包含正确定价",
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"product_id\": 106,\n  \"items\": [{\"customer_type\": \"adult\", \"quantity\": 2}],\n  \"visit_date\": \"2025-12-21\",\n  \"customer\": {\n    \"name\": \"Test User\",\n    \"phone\": \"13900139000\"\n  }\n}"},
            "url": {"raw": "{{base_url}}/miniprogram/orders", "host": ["{{base_url}}"], "path": ["miniprogram", "orders"]}
          }
        },
        {
          "name": "3.2 订单响应时间 [AC-ORDER-2]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 201', function () {",
            "    pm.response.to.have.status(201);",
            "});",
            "",
            "pm.test('Response time is under 2000ms', function () {",
            "    pm.expect(pm.response.responseTime).to.be.below(2000);",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证订单创建响应时间 <2s",
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"product_id\": 107,\n  \"items\": [{\"customer_type\": \"adult\", \"quantity\": 1}],\n  \"visit_date\": \"2025-12-22\",\n  \"customer\": {\"name\": \"Performance Test\", \"phone\": \"13800138000\"}\n}"},
            "url": {"raw": "{{base_url}}/miniprogram/orders", "host": ["{{base_url}}"], "path": ["miniprogram", "orders"]}
          }
        },
        {
          "name": "3.3 订单状态查询 [AC-ORDER-3]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Order status is returned', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('order_id');",
            "    pm.expect(jsonData).to.have.property('status');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "查询订单状态",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/orders/{{order_id}}", "host": ["{{base_url}}"], "path": ["miniprogram", "orders", "{{order_id}}"]}
          }
        }
      ]
    },
    {
      "name": "4. QR票券",
      "description": "AC-QR-1 ~ AC-QR-3: QR码生成和验证测试",
      "item": [
        {
          "name": "4.1 生成QR码 [AC-QR-1]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('QR code data is returned', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('encrypted_data');",
            "    pm.expect(jsonData).to.have.property('qr_image');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "为票券生成 QR 码",
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"expiry_minutes\": 60}"},
            "url": {"raw": "{{base_url}}/qr/public/{{ticket_code}}", "host": ["{{base_url}}"], "path": ["qr", "public", "{{ticket_code}}"]}
          }
        },
        {
          "name": "4.2 QR码包含权益 [AC-QR-2]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Ticket has entitlements', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('entitlements');",
            "    pm.expect(jsonData.entitlements).to.be.an('array');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证 QR 码包含权益信息",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/qr/{{ticket_code}}/info", "host": ["{{base_url}}"], "path": ["qr", "{{ticket_code}}", "info"]}
          }
        },
        {
          "name": "4.3 QR码扫描验证 [AC-QR-3]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Scan result is returned', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData).to.have.property('ticket_code');",
            "    pm.expect(jsonData).to.have.property('status');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证 QR 码可被扫描验证",
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"encrypted_data\": \"test_encrypted_data\"}"},
            "url": {"raw": "{{base_url}}/venue/scan", "host": ["{{base_url}}"], "path": ["venue", "scan"]}
          }
        }
      ]
    },
    {
      "name": "5. 套餐功能",
      "description": "AC-FUNC-1 ~ AC-FUNC-3: 套餐功能验证测试",
      "item": [
        {
          "name": "5.1 Premium Plan 功能 [AC-FUNC-1]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Premium Plan has required functions', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData.functions).to.be.an('array');",
            "    const functionCodes = jsonData.functions.map(f => f.code || f.function_code);",
            "    pm.expect(functionCodes).to.include('ferry');",
            "    pm.expect(functionCodes).to.include('monchhichi_gift');",
            "    pm.expect(functionCodes).to.include('playground_tokens');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证 Premium Plan 包含 ferry + monchhichi_gift + playground_tokens",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/106", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "106"]}
          }
        },
        {
          "name": "5.2 Pet Plan 功能 [AC-FUNC-2]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Pet Plan has required functions', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData.functions).to.be.an('array');",
            "    const functionCodes = jsonData.functions.map(f => f.code || f.function_code);",
            "    pm.expect(functionCodes).to.include('pet_ferry');",
            "    pm.expect(functionCodes).to.include('pet_playground');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证 Pet Plan 包含 pet_ferry + pet_playground",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/107", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "107"]}
          }
        },
        {
          "name": "5.3 Deluxe Tea Set 功能 [AC-FUNC-3]",
          "event": [{"listen": "test", "script": {"exec": [
            "pm.test('Status code is 200', function () {",
            "    pm.response.to.have.status(200);",
            "});",
            "",
            "pm.test('Deluxe Tea Set has required functions', function () {",
            "    const jsonData = pm.response.json();",
            "    pm.expect(jsonData.functions).to.be.an('array');",
            "    const functionCodes = jsonData.functions.map(f => f.code || f.function_code);",
            "    pm.expect(functionCodes).to.include('vip_ferry');",
            "    pm.expect(functionCodes).to.include('tea_set');",
            "    pm.expect(functionCodes).to.include('monchhichi_gift_x2');",
            "});"
          ], "type": "text/javascript"}}],
          "request": {
            "description": "验证 Deluxe Tea Set 包含 vip_ferry + tea_set + monchhichi_gift_x2",
            "method": "GET",
            "header": [],
            "url": {"raw": "{{base_url}}/miniprogram/products/108", "host": ["{{base_url}}"], "path": ["miniprogram", "products", "108"]}
          }
        }
      ]
    }
  ]
}

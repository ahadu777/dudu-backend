{
  "info": {
    "_postman_id": "prd-002-ota-integration-collection",
    "name": "PRD-002 OTA Platform Integration Tests",
    "description": "Tests for PRD-002 - OTA Platform Integration. Tests inventory, bulk ticket generation, activation, and reseller management.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "ota_api_key",
      "value": "ota_full_access_key_99999",
      "type": "string"
    },
    {
      "key": "batch_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "ticket_code",
      "value": "",
      "type": "string"
    },
    {
      "key": "reseller_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "2.1 Query OTA Inventory",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/inventory?product_ids=106,107",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "inventory"],
          "query": [
            {
              "key": "product_ids",
              "value": "106,107"
            }
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has inventory data', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('available_quantities');",
              "    pm.expect(data).to.have.property('pricing_context');",
              "    pm.expect(data).to.have.property('product_info');",
              "});",
              "",
              "pm.test('Product 106 inventory available', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data.available_quantities['106']).to.be.a('number');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.2 List OTA Tickets",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/tickets",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "tickets"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has paginated data', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('items');",
              "    pm.expect(data.items).to.be.an('array');",
              "    pm.expect(data).to.have.property('total');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.3 Bulk Generate Tickets",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"product_id\": 106,\n  \"quantity\": 5,\n  \"distribution_mode\": \"direct_sale\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/tickets/bulk-generate",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "tickets", "bulk-generate"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Tickets generated', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('tickets');",
              "    pm.expect(data.tickets).to.be.an('array');",
              "    pm.expect(data.tickets.length).to.equal(5);",
              "    pm.expect(data).to.have.property('batch_id');",
              "});",
              "",
              "pm.test('Save batch_id and ticket_code', function () {",
              "    const data = pm.response.json();",
              "    pm.collectionVariables.set('batch_id', data.batch_id);",
              "    if (data.tickets.length > 0) {",
              "        pm.collectionVariables.set('ticket_code', data.tickets[0].ticket_code);",
              "    }",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.4 Activate Pre-Made Ticket",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"customer_details\": {\n    \"name\": \"Test Customer\",\n    \"email\": \"test@example.com\",\n    \"phone\": \"13900139000\"\n  },\n  \"customer_type\": \"adult\",\n  \"visit_date\": \"2025-12-20\",\n  \"payment_reference\": \"TEST_PAY_001\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/tickets/{{ticket_code}}/activate",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "tickets", "{{ticket_code}}", "activate"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Ticket activated', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('status');",
              "    pm.expect(data.status).to.equal('ACTIVE');",
              "    pm.expect(data).to.have.property('ticket_code');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.5 List Batches",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/batches",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "batches"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has paginated batches', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('items');",
              "    pm.expect(data.items).to.be.an('array');",
              "    pm.expect(data).to.have.property('total');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.6 List Resellers",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/resellers",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "resellers"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has paginated resellers', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('items');",
              "    pm.expect(data.items).to.be.an('array');",
              "    pm.expect(data).to.have.property('total');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.7 Billing Summary",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/billing/summary?period=2025-12",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "billing", "summary"],
          "query": [
            {
              "key": "period",
              "value": "2025-12"
            }
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has billing data', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('billing_period');",
              "    pm.expect(data).to.have.property('reseller_summaries');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2.8 Batch Analytics",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "{{ota_api_key}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/batches/{{batch_id}}/analytics",
          "host": ["{{base_url}}"],
          "path": ["api", "ota", "batches", "{{batch_id}}", "analytics"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Has analytics data', function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.have.property('batch_id');",
              "    pm.expect(data).to.have.property('tickets_generated');",
              "    pm.expect(data).to.have.property('tickets_activated');",
              "    pm.expect(data).to.have.property('conversion_rates');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "event": []
}

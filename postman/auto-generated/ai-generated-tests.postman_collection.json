{
  "info": {
    "name": "Auto-Generated Tests - US-012",
    "description": "AI-generated test cases from PRD → Story → Card → Implementation analysis",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "api_key",
      "value": "ota_test_key_12345",
      "type": "string"
    },
    {
      "key": "test_batch_id",
      "value": "AI_TEST_{{$timestamp}}",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Business Rule: B2B2C Commission Tracking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Commission rate preserved in reseller metadata\", function() {",
              "    const json = pm.response.json();",
              "    pm.expect(json).to.have.property(\"reseller_metadata\");",
              "    pm.expect(json.reseller_metadata).to.have.property(\"commission_rate\");",
              "    pm.expect(json.reseller_metadata.commission_rate).to.be.a(\"number\");",
              "});",
              "",
              "pm.test(\"Business rule: Commission rate between 0 and 1\", function() {",
              "    const json = pm.response.json();",
              "    const rate = json.reseller_metadata.commission_rate;",
              "    pm.expect(rate).to.be.at.least(0);",
              "    pm.expect(rate).to.be.at.most(1);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "X-API-Key",
            "value": "{{api_key}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"batch_id\": \"{{test_batch_id}}_COMMISSION\",\n  \"product_id\": 106,\n  \"quantity\": 1,\n  \"distribution_mode\": \"reseller_batch\",\n  \"reseller_metadata\": {\n    \"intended_reseller\": \"AI Test Reseller\",\n    \"commission_rate\": 0.15\n  },\n  \"batch_metadata\": {\n    \"campaign_type\": \"test_campaign\"\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/tickets/bulk-generate",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "tickets",
            "bulk-generate"
          ]
        }
      }
    },
    {
      "name": "API Contract: OpenAPI Schema Validation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response matches OpenAPI specification\", function() {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test(\"Required fields present per card specification\", function() {",
              "    const json = pm.response.json();",
              "    pm.expect(json).to.have.property(\"batch_id\");",
              "    pm.expect(json).to.have.property(\"tickets\");",
              "    pm.expect(json).to.have.property(\"total_generated\");",
              "    pm.expect(json).to.have.property(\"pricing_snapshot\");",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "X-API-Key",
            "value": "{{api_key}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"batch_id\": \"{{test_batch_id}}_CONTRACT\",\n  \"product_id\": 106,\n  \"quantity\": 1,\n  \"distribution_mode\": \"reseller_batch\",\n  \"reseller_metadata\": {\n    \"intended_reseller\": \"Contract Test\"\n  },\n  \"batch_metadata\": {\n    \"campaign_type\": \"test_campaign\"\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/tickets/bulk-generate",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "tickets",
            "bulk-generate"
          ]
        }
      }
    },
    {
      "name": "Data Persistence: Database vs Mock Validation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Database mode: Random ticket IDs generated\", function() {",
              "    const json = pm.response.json();",
              "    const firstTicket = json.tickets[0].ticket_code;",
              "    // Database mode generates timestamp-based IDs",
              "    pm.expect(firstTicket).to.match(/CRUISE-2025-FERRY-\\d{13}/);",
              "});",
              "",
              "pm.test(\"Pricing snapshot captured with timestamp\", function() {",
              "    const json = pm.response.json();",
              "    pm.expect(json.pricing_snapshot).to.have.property(\"captured_at\");",
              "    const capturedAt = new Date(json.pricing_snapshot.captured_at);",
              "    const now = new Date();",
              "    pm.expect(Math.abs(now - capturedAt)).to.be.below(10000); // Within 10 seconds",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "X-API-Key",
            "value": "{{api_key}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"batch_id\": \"{{test_batch_id}}_PERSISTENCE\",\n  \"product_id\": 106,\n  \"quantity\": 1,\n  \"distribution_mode\": \"reseller_batch\",\n  \"reseller_metadata\": {\n    \"intended_reseller\": \"Persistence Test\"\n  },\n  \"batch_metadata\": {\n    \"campaign_type\": \"test_campaign\"\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/tickets/bulk-generate",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "tickets",
            "bulk-generate"
          ]
        }
      }
    },
    {
      "name": "Integration: Complete B2B2C Workflow",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"End-to-end workflow: Generation → Activation\", function() {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test(\"Business value chain: Revenue tracking enabled\", function() {",
              "    const json = pm.response.json();",
              "    // Pricing snapshot enables revenue calculation",
              "    pm.expect(json.pricing_snapshot.base_price).to.be.a(\"number\");",
              "    // Commission rate enables reseller billing",
              "    pm.expect(json.reseller_metadata.commission_rate).to.be.a(\"number\");",
              "    // Campaign metadata enables analytics",
              "    pm.expect(json.batch_metadata.campaign_type).to.be.a(\"string\");",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "X-API-Key",
            "value": "{{api_key}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"batch_id\": \"{{test_batch_id}}_INTEGRATION\",\n  \"product_id\": 106,\n  \"quantity\": 2,\n  \"distribution_mode\": \"reseller_batch\",\n  \"reseller_metadata\": {\n    \"intended_reseller\": \"Integration Test Reseller\",\n    \"commission_rate\": 0.2,\n    \"markup_percentage\": 0.3,\n    \"payment_terms\": \"net_30\",\n    \"auto_invoice\": true,\n    \"billing_contact\": \"billing@integration.test\"\n  },\n  \"batch_metadata\": {\n    \"campaign_type\": \"integration_test\",\n    \"campaign_name\": \"AI Framework Validation\",\n    \"promotion_code\": \"AITEST2024\",\n    \"target_demographic\": \"framework_users\",\n    \"geographic_focus\": \"Test Environment\"\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/tickets/bulk-generate",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "tickets",
            "bulk-generate"
          ]
        }
      }
    },
    {
      "name": "Multi-Partner Isolation: Partner A Creates Reservation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Partner A can create reservation\", function() {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test(\"Reservation ID returned\", function() {",
              "    const json = pm.response.json();",
              "    pm.expect(json).to.have.property(\"reservation_id\");",
              "    pm.collectionVariables.set(\"partner_a_reservation_id\", json.reservation_id);",
              "});",
              "",
              "pm.test(\"Pricing snapshot included\", function() {",
              "    const json = pm.response.json();",
              "    pm.expect(json).to.have.property(\"pricing_snapshot\");",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "X-API-Key",
            "value": "ota_full_access_key_99999"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"product_id\": 107,\n  \"quantity\": 5\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/ota/reserve",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "reserve"
          ]
        }
      }
    },
    {
      "name": "Multi-Partner Isolation: Partner B Cannot Access Partner A Reservations",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Partner B cannot see Partner A reservations\", function() {",
              "    pm.response.to.have.status(200);",
              "    const json = pm.response.json();",
              "    const partnerAReservationId = pm.collectionVariables.get(\"partner_a_reservation_id\");",
              "    ",
              "    // Check if Partner A's reservation is in Partner B's list",
              "    const foundReservation = json.reservations.find(r => r.reservation_id === partnerAReservationId);",
              "    pm.expect(foundReservation).to.be.undefined;",
              "});",
              "",
              "pm.test(\"Partner isolation maintained\", function() {",
              "    pm.response.to.have.status(200);",
              "    const json = pm.response.json();",
              "    pm.expect(json).to.have.property(\"reservations\");",
              "    pm.expect(json.reservations).to.be.an(\"array\");",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "ota251103_key_67890"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/reservations",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "reservations"
          ]
        }
      }
    },
    {
      "name": "Multi-Partner Isolation: Shared Inventory Visibility",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Both partners see same inventory pool\", function() {",
              "    pm.response.to.have.status(200);",
              "    const json = pm.response.json();",
              "    ",
              "    // Store Partner B's inventory view",
              "    const partnerBInventory = json.available_quantities[\"107\"];",
              "    pm.collectionVariables.set(\"partner_b_inventory_107\", partnerBInventory);",
              "    ",
              "    pm.expect(partnerBInventory).to.be.a(\"number\");",
              "});",
              "",
              "pm.test(\"Channel allocation working\", function() {",
              "    const json = pm.response.json();",
              "    pm.expect(json).to.have.property(\"available_quantities\");",
              "    pm.expect(json.available_quantities).to.have.property(\"106\");",
              "    pm.expect(json.available_quantities).to.have.property(\"107\");",
              "    pm.expect(json.available_quantities).to.have.property(\"108\");",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "ota251103_key_67890"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/inventory",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "inventory"
          ]
        }
      }
    },
    {
      "name": "Multi-Partner Isolation: Partner A Inventory After Reservation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Partner A sees reduced inventory after reservation\", function() {",
              "    pm.response.to.have.status(200);",
              "    const json = pm.response.json();",
              "    ",
              "    const partnerAInventory = json.available_quantities[\"107\"];",
              "    const partnerBInventory = pm.collectionVariables.get(\"partner_b_inventory_107\");",
              "    ",
              "    // Both partners should see same reduced inventory",
              "    pm.expect(partnerAInventory).to.equal(partnerBInventory);",
              "});",
              "",
              "pm.test(\"Inventory reflects reservation impact\", function() {",
              "    const json = pm.response.json();",
              "    const currentInventory = json.available_quantities[\"107\"];",
              "    pm.expect(currentInventory).to.be.a(\"number\");",
              "    pm.expect(currentInventory).to.be.at.least(0);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-API-Key",
            "value": "ota_full_access_key_99999"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/ota/inventory",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "ota",
            "inventory"
          ]
        }
      }
    }
  ]
}
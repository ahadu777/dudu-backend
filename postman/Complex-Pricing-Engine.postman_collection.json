{
  "info": {
    "name": "Complex Pricing Engine - Complete Coverage",
    "description": "Complete test coverage for complex pricing calculation engine (US-011)\n\nEndpoints:\n- POST /pricing/calculate\n- GET /pricing/rules/:product_id\n\nTest Scenarios:\n- Customer types (adult/child/elderly)\n- Time-based pricing (weekday/weekend/special dates)\n- Add-on products\n- Package tiers\n- Error handling",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "complex-pricing-engine-v1"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Get Pricing Rules",
      "item": [
        {
          "name": "Get Rules - Product 106 (Premium Plan)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/pricing/rules/106",
              "host": ["{{base_url}}"],
              "path": ["pricing", "rules", "106"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has base_prices', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('base_prices');",
                  "    pm.expect(jsonData.base_prices).to.have.property('adult');",
                  "});",
                  "",
                  "pm.test('Response has time_rules', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('time_rules');",
                  "    pm.expect(jsonData.time_rules).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Response has customer_rules', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('customer_rules');",
                  "});",
                  "",
                  "pm.test('Response has available_addons', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('available_addons');",
                  "    pm.expect(jsonData.available_addons).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Rules - Product 107 (Pet Plan)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/pricing/rules/107",
              "host": ["{{base_url}}"],
              "path": ["pricing", "rules", "107"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Rules - Product 108 (Deluxe Tea Set)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/pricing/rules/108",
              "host": ["{{base_url}}"],
              "path": ["pricing", "rules", "108"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Rules - Invalid Product (404)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/pricing/rules/999",
              "host": ["{{base_url}}"],
              "path": ["pricing", "rules", "999"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Error message indicates not found', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('code');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2. Calculate Pricing - Customer Types",
      "item": [
        {
          "name": "2 Adults - Weekday (Product 106)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 2}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has final_total', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('final_total');",
                  "    pm.expect(jsonData.final_total).to.be.a('number');",
                  "});",
                  "",
                  "pm.test('Base price is correct for 2 adults', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // 2 adults × $288 = $576",
                  "    pm.expect(jsonData.base_price).to.equal(576);",
                  "});",
                  "",
                  "pm.test('Breakdown has per_customer_costs', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.breakdown).to.have.property('per_customer_costs');",
                  "    pm.expect(jsonData.breakdown.per_customer_costs).to.be.an('array');",
                  "    pm.expect(jsonData.breakdown.per_customer_costs.length).to.equal(1);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2 Adults - Weekend (Product 106)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-15\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 2}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Weekend pricing applied', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // 2 adults × $318 = $636 (weekend pricing)",
                  "    pm.expect(jsonData.final_total).to.be.at.least(636);",
                  "});",
                  "",
                  "pm.test('Has time adjustments', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.breakdown.time_adjustments).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Mixed: 1 Adult + 2 Children - Weekday",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1},\n    {\"customer_type\": \"child\", \"count\": 2}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Correct pricing for mixed types', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // 1 adult × $288 + 2 children × $188 = $288 + $376 = $664",
                  "    pm.expect(jsonData.base_price).to.equal(664);",
                  "});",
                  "",
                  "pm.test('Breakdown shows both customer types', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.breakdown.per_customer_costs.length).to.equal(2);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Elderly Customer - Weekday",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"elderly\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Elderly pricing is $188', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.base_price).to.equal(188);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "3. Calculate Pricing - Add-ons",
      "item": [
        {
          "name": "2 Adults + Plan A Addon",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 2}\n  ],\n  \"addons\": [\n    {\"addon_id\": \"tokens-plan-a\", \"quantity\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Addons total is calculated', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('addons_total');",
                  "    pm.expect(jsonData.addons_total).to.equal(100);",
                  "});",
                  "",
                  "pm.test('Final total includes addons', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // $576 (base) + $100 (addon) = $676",
                  "    pm.expect(jsonData.final_total).to.equal(676);",
                  "});",
                  "",
                  "pm.test('Breakdown has addon details', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.breakdown).to.have.property('addon_details');",
                  "    pm.expect(jsonData.breakdown.addon_details).to.be.an('array');",
                  "    pm.expect(jsonData.breakdown.addon_details.length).to.equal(1);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Multiple Addons",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1}\n  ],\n  \"addons\": [\n    {\"addon_id\": \"tokens-plan-a\", \"quantity\": 2},\n    {\"addon_id\": \"tokens-plan-b\", \"quantity\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Multiple addons calculated correctly', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // 2 × $100 + 1 × $180 = $380",
                  "    pm.expect(jsonData.addons_total).to.equal(380);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "4. Calculate Pricing - Special Dates",
      "item": [
        {
          "name": "Special Date - New Year's Eve (2025-12-31)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-12-31\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Special date detected', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.breakdown.time_adjustments).to.be.an('array');",
                  "    var specialAdjustment = jsonData.breakdown.time_adjustments.find(a => a.day_type === 'special');",
                  "    pm.expect(specialAdjustment).to.exist;",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5. Calculate Pricing - Different Products",
      "item": [
        {
          "name": "Product 107 (Pet Plan) - Flat Rate",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 107,\n  \"booking_dates\": [\"2025-11-15\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 2}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Pet Plan flat rate pricing', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // 2 × $188 = $376 (flat rate, no weekend premium)",
                  "    pm.expect(jsonData.base_price).to.equal(376);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Product 108 (Deluxe) - Weekend",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 108,\n  \"booking_dates\": [\"2025-11-15\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Deluxe weekend pricing', function () {",
                  "    var jsonData = pm.response.json();",
                  "    // $888 for weekend",
                  "    pm.expect(jsonData.final_total).to.be.at.least(888);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "6. Error Handling",
      "item": [
        {
          "name": "Missing product_id (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error message indicates missing product_id', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('code');",
                  "    pm.expect(jsonData.code).to.equal('INVALID_REQUEST');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Invalid customer type (422)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"invalid\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 422', function () {",
                  "    pm.response.to.have.status(422);",
                  "});",
                  "",
                  "pm.test('Error message indicates invalid customer type', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('code');",
                  "    pm.expect(jsonData.code).to.equal('INVALID_CUSTOMER_TYPE');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Invalid date format (422)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 106,\n  \"booking_dates\": [\"invalid-date\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 422', function () {",
                  "    pm.response.to.have.status(422);",
                  "});",
                  "",
                  "pm.test('Error message indicates invalid date', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('code');",
                  "    pm.expect(jsonData.code).to.equal('INVALID_DATE');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Product not found (404)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": 999,\n  \"booking_dates\": [\"2025-11-10\"],\n  \"customer_breakdown\": [\n    {\"customer_type\": \"adult\", \"count\": 1}\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/pricing/calculate",
              "host": ["{{base_url}}"],
              "path": ["pricing", "calculate"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Error message indicates product not found', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('code');",
                  "    pm.expect(jsonData.code).to.equal('PRODUCT_NOT_FOUND');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}

